<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>B·ªô tr·ªëng gi·∫£ l·∫≠p ‚Äî C·ª±c nh·∫°y (iPhone OK)</title>
<style>
  :root{
    --bg:#0b0f14;
    --panel:#0f1720;
    --accent:#ffb86b;
    --muted:#98a0aa;
    --glass: rgba(255,255,255,0.04);
  }
  html,body{
    height:100%;
    margin:0;
    background:linear-gradient(180deg,var(--bg),#071019 80%);
    color:#e6eef6;
    font-family:system-ui,Segoe UI,Roboto,Arial;
    -webkit-font-smoothing:antialiased;
  }
  .app{ max-width:960px; margin:auto; padding:12px; }
  h1{ font-size:18px; margin:10px 0; text-align:center; }
  .grid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:12px;
  }
  @media (max-width:500px){
    .grid{ grid-template-columns: repeat(2,1fr); }
  }
  .pad{
    background:var(--panel);
    border-radius:12px;
    min-height:110px;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
    touch-action: none;
    user-select:none;
    box-shadow: 0 6px 16px rgba(0,0,0,0.5);
  }
  .pad .label{
    position:absolute; left:10px; top:10px; font-size:12px; color:var(--muted);
  }
  .pad:active,.pad.active{ background:#16232e; box-shadow:0 0 18px rgba(255,184,107,0.2);}
  .ripple{
    position:absolute;
    border-radius:999px;
    transform:translate(-50%,-50%) scale(0.001);
    opacity:0.8;
    pointer-events:none;
    transition:transform 0.4s ease-out, opacity 0.5s ease-out;
    background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18), rgba(255,255,255,0.02));
  }
  button{
    background:var(--glass);
    color:#ddd;
    border:1px solid rgba(255,255,255,0.05);
    border-radius:8px;
    padding:8px 14px;
    font-size:14px;
    margin:10px auto;
    display:block;
  }
  footer{ margin-top:14px; font-size:12px; color:var(--muted); text-align:center; }
</style>
</head>
<body>
<div class="app">
  <h1>ü•Å B·ªô tr·ªëng gi·∫£ l·∫≠p ‚Äî C·ª±c nh·∫°y (iPhone OK)</h1>
  <button id="enableAudio">B·∫≠t √¢m (ch·∫°m 1 l·∫ßn ƒë·ªÉ k√≠ch ho·∫°t √¢m thanh)</button>

  <div class="grid" id="pads">
    <div class="pad" data-drum="kick"><div class="label">Kick</div>KICK</div>
    <div class="pad" data-drum="snare"><div class="label">Snare</div>SNARE</div>
    <div class="pad" data-drum="hat"><div class="label">Hi-Hat</div>HAT</div>
    <div class="pad" data-drum="tom1"><div class="label">Tom 1</div>TOM1</div>
    <div class="pad" data-drum="tom2"><div class="label">Tom 2</div>TOM2</div>
    <div class="pad" data-drum="crash"><div class="label">Crash</div>CRASH</div>
  </div>

  <footer>
    N·∫øu kh√¥ng nghe √¢m thanh, h√£y ch·∫°m n√∫t "B·∫≠t √¢m" m·ªôt l·∫ßn.<br/>
    Sau ƒë√≥ ch·∫°m pad b·∫•t k·ª≥ ƒë·ªÉ ch∆°i.
  </footer>
</div>

<script>
(() => {
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  let ctx, masterGain;
  let volume = 0.9;

  function initAudio() {
    if (!ctx) {
      ctx = new AudioContext();
      masterGain = ctx.createGain();
      masterGain.gain.value = volume;
      masterGain.connect(ctx.destination);
      console.log("üîä Audio initialized");
    }
    if (ctx.state === "suspended") ctx.resume();
  }

  // iPhone c·∫ßn √≠t nh·∫•t m·ªôt ch·∫°m th·∫≠t
  ['touchstart','mousedown','pointerdown'].forEach(ev=>{
    document.body.addEventListener(ev,()=>initAudio(),{once:true});
  });

  document.getElementById('enableAudio').addEventListener('click', async ()=>{
    initAudio();
    if (ctx.state === 'suspended') await ctx.resume();
    const btn = document.getElementById('enableAudio');
    btn.textContent = '√Çm ƒë√£ b·∫≠t ‚úî';
    btn.disabled = true;
  });

  // --- C√°c √¢m tr·ªëng synth ---
  function playKick(s=1){
    const now = ctx.currentTime;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = 'sine';
    o.frequency.setValueAtTime(150, now);
    o.frequency.exponentialRampToValueAtTime(50, now + 0.3);
    g.gain.setValueAtTime(1*s, now);
    g.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
    o.connect(g).connect(masterGain);
    o.start(now); o.stop(now+0.4);
  }
  function playSnare(s=1){
    const now = ctx.currentTime;
    const noise = ctx.createBufferSource();
    const buffer = ctx.createBuffer(1, ctx.sampleRate*0.2, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i=0;i<data.length;i++){ data[i]=(Math.random()*2-1)*Math.pow(1-i/data.length,1.4);}
    noise.buffer=buffer;
    const noiseFilter=ctx.createBiquadFilter();
    noiseFilter.type='bandpass';
    noiseFilter.frequency.value=1800;
    const noiseGain=ctx.createGain();
    noiseGain.gain.setValueAtTime(1*s, now);
    noiseGain.gain.exponentialRampToValueAtTime(0.01, now+0.25);
    noise.connect(noiseFilter).connect(noiseGain).connect(masterGain);
    noise.start(now); noise.stop(now+0.3);
  }
  function playHat(s=1){
    const now=ctx.currentTime;
    const noise=ctx.createBufferSource();
    const buffer=ctx.createBuffer(1, ctx.sampleRate*0.05, ctx.sampleRate);
    const data=buffer.getChannelData(0);
    for(let i=0;i<data.length;i++){data[i]=Math.random()*2-1;}
    noise.buffer=buffer;
    const hp=ctx.createBiquadFilter();
    hp.type='highpass';
    hp.frequency.value=6000;
    const g=ctx.createGain();
    g.gain.setValueAtTime(1*s, now);
    g.gain.exponentialRampToValueAtTime(0.01, now+0.08);
    noise.connect(hp).connect(g).connect(masterGain);
    noise.start(now); noise.stop(now+0.1);
  }
  function playTom(freq=300,s=1){
    const now=ctx.currentTime;
    const o=ctx.createOscillator();
    const g=ctx.createGain();
    o.type='sine';
    o.frequency.setValueAtTime(freq, now);
    o.frequency.exponentialRampToValueAtTime(freq*0.6, now+0.25);
    g.gain.setValueAtTime(1*s, now);
    g.gain.exponentialRampToValueAtTime(0.01, now+0.3);
    o.connect(g).connect(masterGain);
    o.start(now); o.stop(now+0.4);
  }
  function playCrash(s=1){
    const now=ctx.currentTime;
    const n=ctx.createBufferSource();
    const buffer=ctx.createBuffer(1, ctx.sampleRate*1.5, ctx.sampleRate);
    const d=buffer.getChannelData(0);
    for(let i=0;i<d.length;i++){d[i]=(Math.random()*2-1)*Math.pow(1-i/d.length,0.6);}
    n.buffer=buffer;
    const f=ctx.createBiquadFilter();
    f.type='highpass';
    f.frequency.value=5000;
    const g=ctx.createGain();
    g.gain.setValueAtTime(1*s, now);
    g.gain.exponentialRampToValueAtTime(0.01, now+1.2);
    n.connect(f).connect(g).connect(masterGain);
    n.start(now); n.stop(now+1.4);
  }

  // Ripple hi·ªáu ·ª©ng
  function rippleAt(pad,x,y){
    const r=document.createElement('div');
    r.className='ripple';
    const size=Math.max(pad.clientWidth,pad.clientHeight);
    r.style.width=r.style.height=size+'px';
    r.style.left=x+'px'; r.style.top=y+'px';
    pad.appendChild(r);
    requestAnimationFrame(()=>r.style.transform='translate(-50%,-50%) scale(1)');
    setTimeout(()=>{r.style.opacity='0'; setTimeout(()=>r.remove(),400);},100);
  }

  // G·∫Øn s·ª± ki·ªán
  document.querySelectorAll('.pad').forEach(pad=>{
    pad.addEventListener('pointerdown', e=>{
      initAudio();
      const rect=pad.getBoundingClientRect();
      rippleAt(pad, e.clientX-rect.left, e.clientY-rect.top);
      const drum=pad.dataset.drum;
      switch(drum){
        case'kick':playKick();break;
        case'snare':playSnare();break;
        case'hat':playHat();break;
        case'tom1':playTom(450);break;
        case'tom2':playTom(300);break;
        case'crash':playCrash();break;
      }
      pad.classList.add('active');
      setTimeout(()=>pad.classList.remove('active'),150);
    });
  });
})();
</script>
</body>
</html>