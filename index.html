<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ƒê√†n Piano - Tone Dm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

```
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 5px;
        touch-action: manipulation;
        overflow-x: hidden;
    }
    
    .start-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        transition: opacity 0.3s;
    }
    
    .start-overlay.hidden {
        opacity: 0;
        pointer-events: none;
    }
    
    .start-btn {
        background: linear-gradient(145deg, #4CAF50, #45a049);
        color: white;
        border: none;
        border-radius: 15px;
        padding: 25px 50px;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 8px 15px rgba(0,0,0,0.5);
        transition: all 0.2s;
        touch-action: manipulation;
    }
    
    .start-btn:active {
        transform: scale(0.95);
        box-shadow: 0 5px 10px rgba(0,0,0,0.5);
    }
    
    .start-text {
        color: white;
        font-size: 18px;
        margin-bottom: 20px;
        text-align: center;
        padding: 0 20px;
    }
    
    .container {
        width: 100%;
        max-width: 100vw;
    }
    
    .title {
        text-align: center;
        color: white;
        margin-bottom: 8px;
        font-size: 18px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .chords-section {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 8px;
    }
    
    .chords-title {
        color: white;
        font-size: 14px;
        margin-bottom: 8px;
        text-align: center;
    }
    
    .chords-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 5px;
    }
    
    .chord-btn {
        background: linear-gradient(145deg, #4CAF50, #45a049);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 5px;
        font-size: 14px;
        font-weight: bold;
        cursor: move;
        box-shadow: 0 3px 5px rgba(0,0,0,0.3);
        transition: all 0.1s;
        touch-action: none;
        user-select: none;
    }
    
    .chord-btn:active {
        transform: scale(0.95);
        box-shadow: 0 2px 3px rgba(0,0,0,0.3);
        background: linear-gradient(145deg, #66BB6A, #5CB860);
    }
    
    .chord-btn.dragging {
        opacity: 0.5;
        transform: scale(1.05);
        z-index: 100;
    }
    
    .chord-btn.drag-over {
        border: 2px dashed white;
    }
    
    .piano-container {
        background: rgba(0,0,0,0.3);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        overflow-x: auto;
        overflow-y: hidden;
    }
    
    .piano {
        position: relative;
        height: 180px;
        width: 840px;
        margin: 0 auto;
    }
    
    .white-key {
        position: absolute;
        width: 60px;
        height: 180px;
        background: linear-gradient(to bottom, #ffffff 0%, #f0f0f0 100%);
        border: 2px solid #222;
        border-radius: 0 0 5px 5px;
        cursor: pointer;
        user-select: none;
        touch-action: manipulation;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 8px;
        font-size: 11px;
        color: #666;
        font-weight: bold;
    }
    
    .white-key:active {
        background: linear-gradient(to bottom, #e8e8e8 0%, #d8d8d8 100%);
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .black-key {
        position: absolute;
        width: 40px;
        height: 115px;
        background: linear-gradient(to bottom, #444 0%, #000 100%);
        border: 1px solid #000;
        border-radius: 0 0 3px 3px;
        cursor: pointer;
        user-select: none;
        touch-action: manipulation;
        z-index: 10;
        color: white;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 6px;
        font-size: 9px;
        font-weight: bold;
        box-shadow: 0 3px 5px rgba(0,0,0,0.5);
    }
    
    .black-key:active {
        background: linear-gradient(to bottom, #666 0%, #333 100%);
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
    }
    
    .info {
        text-align: center;
        color: white;
        margin-top: 8px;
        font-size: 12px;
        line-height: 1.4;
    }
    
    .drag-hint {
        text-align: center;
        color: rgba(255, 255, 255, 0.8);
        font-size: 11px;
        margin-top: 5px;
    }

    @media (max-width: 600px) {
        .chords-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }
</style>
```

</head>
<body>
    <!-- M√†n h√¨nh b·∫Øt ƒë·∫ßu -->
    <div class="start-overlay" id="startOverlay">
        <div class="start-text">üéπ B·∫•m n√∫t b√™n d∆∞·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu ch∆°i nh·∫°c</div>
        <button class="start-btn" id="startBtn">üéµ B·∫ÆT ƒê·∫¶U CH∆†I</button>
    </div>

```
<div class="container">
    <h1 class="title">üéπ ƒê√†n Piano - Tone Dm</h1>
    
    <div class="chords-section">
        <div class="chords-title">üéµ H·ª£p √Çm (B·∫•m ƒë·ªÉ ph√°t c√πng l√∫c)</div>
        <div class="chords-grid" id="chordsGrid">
            <button class="chord-btn" data-chord="Dm" draggable="true">Dm</button>
            <button class="chord-btn" data-chord="Am" draggable="true">Am</button>
            <button class="chord-btn" data-chord="Bb" draggable="true">B‚ô≠</button>
            <button class="chord-btn" data-chord="C" draggable="true">C</button>
            <button class="chord-btn" data-chord="F" draggable="true">F</button>
            <button class="chord-btn" data-chord="Gm" draggable="true">Gm</button>
            <button class="chord-btn" data-chord="A7" draggable="true">A7</button>
            <button class="chord-btn" data-chord="Dm7" draggable="true">Dm7</button>
        </div>
        <div class="drag-hint">üí° Gi·ªØ v√† k√©o ƒë·ªÉ s·∫Øp x·∫øp l·∫°i v·ªã tr√≠ h·ª£p √¢m</div>
    </div>
    
    <div class="piano-container">
        <div class="piano" id="piano"></div>
    </div>
    
    <div class="info">
        B·∫•m h·ª£p √¢m ph√≠a tr√™n ƒë·ªÉ ph√°t c√°c n·ªët c√πng l√∫c<br>
        B·∫•m ph√≠m ƒë√†n b√™n d∆∞·ªõi ƒë·ªÉ ƒë√†n giai ƒëi·ªáu
    </div>
</div>

<script>
    let audioContext = null;
    let isStarted = false;
    
    // Kh·ªüi t·∫°o AudioContext
    function initAudioContext() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }
    }
    
    // ƒê·ªãnh nghƒ©a c√°c n·ªët nh·∫°c
    const notes = {
        'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
        'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
        'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
        'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25, 
        'E5': 659.25, 'F5': 698.46, 'F#5': 739.99, 'G5': 783.99,
        'G#5': 830.61, 'A5': 880.00, 'A#5': 932.33, 'B5': 987.77
    };
    
    // ƒê·ªãnh nghƒ©a h·ª£p √¢m
    const chords = {
        'Dm': ['D4', 'F4', 'A4'],
        'Am': ['A4', 'C5', 'E5'],
        'Bb': ['A#4', 'D5', 'F4'],
        'C': ['C4', 'E4', 'G4'],
        'F': ['F4', 'A4', 'C5'],
        'Gm': ['G4', 'A#4', 'D5'],
        'A7': ['A4', 'C#5', 'E5', 'G4'],
        'Dm7': ['D4', 'F4', 'A4', 'C5']
    };
    
    // T·∫°o b√†n ph√≠m piano
    const piano = document.getElementById('piano');
    
    const whiteKeysData = [
        {note: 'C4', left: 0}, {note: 'D4', left: 60}, {note: 'E4', left: 120},
        {note: 'F4', left: 180}, {note: 'G4', left: 240}, {note: 'A4', left: 300},
        {note: 'B4', left: 360}, {note: 'C5', left: 420}, {note: 'D5', left: 480},
        {note: 'E5', left: 540}, {note: 'F5', left: 600}, {note: 'G5', left: 660},
        {note: 'A5', left: 720}, {note: 'B5', left: 780}
    ];
    
    const blackKeysData = [
        {note: 'C#4', left: 40}, {note: 'D#4', left: 100},
        {note: 'F#4', left: 220}, {note: 'G#4', left: 280}, {note: 'A#4', left: 340},
        {note: 'C#5', left: 460}, {note: 'D#5', left: 520},
        {note: 'F#5', left: 640}, {note: 'G#5', left: 700}, {note: 'A#5', left: 760}
    ];
    
    // T·∫°o ph√≠m tr·∫Øng
    whiteKeysData.forEach(data => {
        const key = document.createElement('div');
        key.className = 'white-key';
        key.dataset.note = data.note;
        key.textContent = data.note;
        key.style.left = data.left + 'px';
        
        key.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (isStarted) playNote(data.note);
        });
        key.addEventListener('mousedown', () => {
            if (isStarted) playNote(data.note);
        });
        
        piano.appendChild(key);
    });
    
    // T·∫°o ph√≠m ƒëen
    blackKeysData.forEach(data => {
        const key = document.createElement('div');
        key.className = 'black-key';
        key.dataset.note = data.note;
        key.textContent = data.note;
        key.style.left = data.left + 'px';
        
        key.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (isStarted) playNote(data.note);
        });
        key.addEventListener('mousedown', () => {
            if (isStarted) playNote(data.note);
        });
        
        piano.appendChild(key);
    });
    
    // H√†m ph√°t √¢m thanh
    function playNote(note, duration = 1.5) {
        if (!audioContext || !notes[note]) return;
        
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = notes[note];
        oscillator.type = 'sine';
        
        const now = audioContext.currentTime;
        gainNode.gain.setValueAtTime(0, now);
        gainNode.gain.linearRampToValueAtTime(0.3, now + 0.01);
        gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
        
        oscillator.start(now);
        oscillator.stop(now + duration);
    }
    
    // H√†m ph√°t h·ª£p √¢m - T·∫§T C·∫¢ C√ÅC N·ªêT C√ôNG L√öC
    function playChord(chordName) {
        const chordNotes = chords[chordName];
        if (!chordNotes) return;
        
        // Ph√°t t·∫•t c·∫£ c√°c n·ªët c√πng l√∫c
        chordNotes.forEach(note => {
            playNote(note, 2.0);
        });
    }
    
    // X·ª≠ l√Ω n√∫t h·ª£p √¢m
    const chordsGrid = document.getElementById('chordsGrid');
    let draggedElement = null;
    let isDragging = false;
    let dragStartTime = 0;
    
    function setupChordButtons() {
        const chordButtons = document.querySelectorAll('.chord-btn');
        
        chordButtons.forEach(btn => {
            // X·ª≠ l√Ω ph√°t √¢m (click/tap nhanh)
            let touchStartTime = 0;
            
            btn.addEventListener('touchstart', (e) => {
                touchStartTime = Date.now();
            });
            
            btn.addEventListener('touchend', (e) => {
                const touchDuration = Date.now() - touchStartTime;
                // N·∫øu tap nhanh (< 200ms) th√¨ ph√°t √¢m
                if (touchDuration < 200 && !isDragging && isStarted) {
                    e.preventDefault();
                    playChord(btn.dataset.chord);
                }
            });
            
            btn.addEventListener('click', (e) => {
                if (!isDragging && isStarted) {
                    playChord(btn.dataset.chord);
                }
            });
            
            // Desktop drag events
            btn.addEventListener('dragstart', (e) => {
                draggedElement = btn;
                dragStartTime = Date.now();
                setTimeout(() => {
                    btn.classList.add('dragging');
                    isDragging = true;
                }, 0);
                e.dataTransfer.effectAllowed = 'move';
            });
            
            btn.addEventListener('dragend', (e) => {
                btn.classList.remove('dragging');
                setTimeout(() => isDragging = false, 100);
            });
            
            btn.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (draggedElement && draggedElement !== btn) {
                    btn.classList.add('drag-over');
                }
            });
            
            btn.addEventListener('dragleave', (e) => {
                btn.classList.remove('drag-over');
            });
            
            btn.addEventListener('drop', (e) => {
                e.preventDefault();
                btn.classList.remove('drag-over');
                
                if (draggedElement && draggedElement !== btn) {
                    swapElements(draggedElement, btn);
                }
                draggedElement = null;
            });
            
            // Touch drag for mobile
            let touchStartX, touchStartY;
            let currentTouchElement = null;
            
            btn.addEventListener('touchstart', (e) => {
                const touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
                dragStartTime = Date.now();
                currentTouchElement = btn;
            }, { passive: true });
            
            btn.addEventListener('touchmove', (e) => {
                const touch = e.touches[0];
                const deltaX = Math.abs(touch.clientX - touchStartX);
                const deltaY = Math.abs(touch.clientY - touchStartY);
                const duration = Date.now() - dragStartTime;
                
                // N·∫øu di chuy·ªÉn > 10px ho·∫∑c gi·ªØ > 200ms th√¨ b·∫Øt ƒë·∫ßu drag
                if ((deltaX > 10 || deltaY > 10 || duration > 200) && currentTouchElement) {
                    e.preventDefault();
                    isDragging = true;
                    btn.classList.add('dragging');
                    
                    // T√¨m element ·ªü v·ªã tr√≠ touch
                    const elementAtPoint = document.elementFromPoint(touch.clientX, touch.clientY);
                    const targetBtn = elementAtPoint?.closest('.chord-btn');
                    
                    // Remove drag-over t·ª´ t·∫•t c·∫£
                    document.querySelectorAll('.chord-btn').forEach(b => {
                        b.classList.remove('drag-over');
                    });
                    
                    // Add drag-over cho target
                    if (targetBtn && targetBtn !== btn) {
                        targetBtn.classList.add('drag-over');
                    }
                }
            }, { passive: false });
            
            btn.addEventListener('touchend', (e) => {
                if (isDragging && currentTouchElement) {
                    e.preventDefault();
                    const touch = e.changedTouches[0];
                    const elementAtPoint = document.elementFromPoint(touch.clientX, touch.clientY);
                    const targetBtn = elementAtPoint?.closest('.chord-btn');
                    
                    if (targetBtn && targetBtn !== btn) {
                        swapElements(btn, targetBtn);
                    }
                }
                
                btn.classList.remove('dragging');
                document.querySelectorAll('.chord-btn').forEach(b => {
                    b.classList.remove('drag-over');
                });
                
                setTimeout(() => {
                    isDragging = false;
                    currentTouchElement = null;
                }, 100);
            });
        });
    }
    
    function swapElements(elem1, elem2) {
        const parent = elem1.parentNode;
        const next1 = elem1.nextSibling;
        const next2 = elem2.nextSibling;
        
        if (next1 === elem2) {
            parent.insertBefore(elem2, elem1);
        } else if (next2 === elem1) {
            parent.insertBefore(elem1, elem2);
        } else {
            if (next1) {
                parent.insertBefore(elem2, next1);
            } else {
                parent.appendChild(elem2);
            }
            
            if (next2) {
                parent.insertBefore(elem1, next2);
            } else {
                parent.appendChild(elem1);
            }
        }
    }
    
    setupChordButtons();
    
    // X·ª≠ l√Ω n√∫t b·∫Øt ƒë·∫ßu
    const startBtn = document.getElementById('startBtn');
    const startOverlay = document.getElementById('startOverlay');
    
    startBtn.addEventListener('click', () => {
        initAudioContext();
        isStarted = true;
        startOverlay.classList.add('hidden');
        
        // Ph√°t √¢m thanh demo ƒë·ªÉ k√≠ch ho·∫°t
        playNote('C4', 0.1);
    });
    
    startBtn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        initAudioContext();
        isStarted = true;
        startOverlay.classList.add('hidden');
        
        // Ph√°t √¢m thanh demo ƒë·ªÉ k√≠ch ho·∫°t
        playNote('C4', 0.1);
    });
</script>
```

</body>
</html>