<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Báº£n Ä‘á»“ chia sáº» vá»‹ trÃ­</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #f2f2f2;
    font-family: sans-serif;
    text-align: center;
  }
  #map {
    width: 100%;
    height: 80vh;
  }
  #info {
    padding: 10px;
  }
  button {
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    background: #4CAF50;
    color: white;
  }
</style>
</head>
<body>

<h2>ğŸŒ Chia sáº» vá»‹ trÃ­ theo thá»i gian thá»±c</h2>
<div id="info">Nháº¥n nÃºt bÃªn dÆ°á»›i Ä‘á»ƒ báº¯t Ä‘áº§u chia sáº» vá»‹ trÃ­</div>
<button onclick="startShare()">ğŸ“ Báº¯t Ä‘áº§u chia sáº» vá»‹ trÃ­</button>
<div id="map"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// === Cáº¥u hÃ¬nh Firebase cá»§a báº¡n ===
const firebaseConfig = {
  databaseURL: "https://mapgps-6fa8a-default-rtdb.asia-southeast1.firebasedatabase.app/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// === TÃªn ngÆ°á»i chia sáº» (cÃ³ thá»ƒ sá»­a theo tá»«ng ngÆ°á»i) ===
const USERNAME = "nhut"; // vÃ­ dá»¥: "van", "nhut", "y"

// === Báº¯t Ä‘áº§u chia sáº» vá»‹ trÃ­ ===
function startShare() {
  if (!navigator.geolocation) {
    alert("Thiáº¿t bá»‹ cá»§a báº¡n khÃ´ng há»— trá»£ Ä‘á»‹nh vá»‹ GPS");
    return;
  }

  document.getElementById("info").innerText = "Äang chia sáº» vá»‹ trÃ­...";
  
  navigator.geolocation.watchPosition(
    pos => {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;
      const timestamp = Date.now();
      firebase.database().ref("locations/" + USERNAME).set({ lat, lng, timestamp });
    },
    err => alert("KhÃ´ng láº¥y Ä‘Æ°á»£c vá»‹ trÃ­: " + err.message),
    { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
  );
}

// === Hiá»ƒn thá»‹ báº£n Ä‘á»“ & theo dÃµi vá»‹ trÃ­ ===
let map, marker;

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 10.8, lng: 106.6 },
    zoom: 14,
  });

  marker = new google.maps.Marker({
    map,
    title: "Vá»‹ trÃ­ hiá»‡n táº¡i"
  });

  // Láº¯ng nghe dá»¯ liá»‡u vá»‹ trÃ­ tá»« Firebase
  firebase.database().ref("locations/" + USERNAME).on("value", snap => {
    const data = snap.val();
    if (data) {
      const latLng = new google.maps.LatLng(data.lat, data.lng);
      marker.setPosition(latLng);
      map.setCenter(latLng);
      document.getElementById("info").innerHTML =
        `ğŸ“ Vá»‹ trÃ­ hiá»‡n táº¡i:<br>Lat: ${data.lat.toFixed(5)}, Lng: ${data.lng.toFixed(5)}<br>
         â± Cáº­p nháº­t: ${new Date(data.timestamp).toLocaleTimeString()}<br><br>
         <a href="https://www.google.com/maps/dir/?api=1&destination=${data.lat},${data.lng}" target="_blank">ğŸ§­ Chá»‰ Ä‘Æ°á»ng Ä‘áº¿n Ä‘Ã¢y</a>`;
    }
  });
}
</script>

<!-- Google Maps API -->
<script async defer src="https://maps.googleapis.com/maps/api/js?callback=initMap"></script>

</body>
</html>
