<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒêi·ªÉm danh Check-in/Check-out (Firebase Demo)</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; }
    label { display: block; margin-top: 8px; }
    #list { margin-top: 16px; }
    table { border-collapse: collapse; }
    td, th { border: 1px solid #ccc; padding: 4px 8px; }
    th { background: #f5f5f5; }
  </style>
</head>
<body>
  <h2>ƒêi·ªÉm danh Check-in/Check-out (Firebase)</h2>
  <form id="form">
    <label>
      S·ª± ki·ªán:
      <input id="event-id" value="event-2025" required>
    </label>
    <label>
      H·ªç t√™n:
      <input id="name" required>
    </label>
    <label>
      M√£ s·ªë/Nick/ID:
      <input id="userid" required>
    </label>
    <button type="button" onclick="checkin()">Check-in</button>
    <button type="button" onclick="checkout()">Check-out</button>
  </form>
  <div id="status"></div>
  <div id="list"></div>
<script>
  // === Init Firebase ===
  const firebaseConfig = {
    databaseURL: "https://nhutvan5c-79ce9-default-rtdb.asia-southeast1.firebasedatabase.app/"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // === Check-in function ===
  async function checkin() {
    let eventId = document.getElementById('event-id').value.trim();
    let name = document.getElementById('name').value.trim();
    let userid = document.getElementById('userid').value.trim();
    if (!eventId || !name || !userid) return;
    let now = Math.floor(Date.now()/1000);
    await db.ref(`events/${eventId}/checkins/${userid}`).update({
      name,
      checkin: now
    });
    document.getElementById('status').innerText = `‚úÖ ${name} ƒë√£ check-in l√∫c ${new Date(now*1000).toLocaleTimeString()}`;
  }

  // === Check-out function ===
  async function checkout() {
    let eventId = document.getElementById('event-id').value.trim();
    let name = document.getElementById('name').value.trim();
    let userid = document.getElementById('userid').value.trim();
    if (!eventId || !name || !userid) return;
    let now = Math.floor(Date.now()/1000);
    await db.ref(`events/${eventId}/checkins/${userid}`).update({
      name,
      checkout: now
    });
    document.getElementById('status').innerText = `üëã ${name} ƒë√£ check-out l√∫c ${new Date(now*1000).toLocaleTimeString()}`;
  }

  // === Hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi ƒë√£ check-in/check-out ===
  document.getElementById('event-id').addEventListener('input', watchList);
  function watchList() {
    let eventId = document.getElementById('event-id').value.trim();
    if (!eventId) return;
    db.ref(`events/${eventId}/checkins`).on('value', snap => {
      let data = snap.val();
      let html = `<h3>Danh s√°ch ƒëi·ªÉm danh</h3><table><tr><th>H·ªç t√™n</th><th>Check-in</th><th>Check-out</th></tr>`;
      if (data) {
        for (let user in data) {
          let u = data[user];
          html += `<tr>
            <td>${u.name || ''}</td>
            <td>${u.checkin ? new Date(u.checkin*1000).toLocaleTimeString() : ''}</td>
            <td>${u.checkout ? new Date(u.checkout*1000).toLocaleTimeString() : ''}</td>
          </tr>`;
        }
      }
      html += `</table>`;
      document.getElementById('list').innerHTML = html;
    });
  }
  watchList();
</script>
</body>
</html>