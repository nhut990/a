<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karaoke App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .search-section {
            margin-bottom: 30px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #searchInput {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #667eea;
            border-radius: 10px;
            outline: none;
        }
        
        #searchBtn {
            padding: 15px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        #searchBtn:hover {
            background: #5568d3;
        }
        
        .video-section {
            margin-bottom: 30px;
        }
        
        #youtubePlayer {
            width: 100%;
            height: 450px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .controls-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .control-group {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .control-group h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .control-item {
            margin-bottom: 15px;
        }
        
        .control-item label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }
        
        .value-display {
            display: inline-block;
            min-width: 50px;
            text-align: right;
            color: #667eea;
            font-weight: bold;
        }
        
        .mic-status {
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }
        
        .mic-on {
            background: #48bb78;
            color: white;
        }
        
        .mic-off {
            background: #f56565;
            color: white;
        }
        
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
        
        .instructions h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            margin-left: 20px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Karaoke App üéµ</h1>
        
        <div class="instructions">
            <h4>üìå H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</h4>
            <ul>
                <li>T√¨m ki·∫øm video karaoke tr√™n YouTube v√† nh·∫•n T√¨m ki·∫øm</li>
                <li>Nh·∫•n "B·∫≠t Micro" v√† cho ph√©p truy c·∫≠p micro</li>
                <li>C·∫Øm tai nghe ƒë·ªÉ tr√°nh h√∫ h·ªìi √¢m (feedback)</li>
                <li>ƒêi·ªÅu ch·ªânh c√°c hi·ªáu ·ª©ng micro v√† √¢m l∆∞·ª£ng theo √Ω mu·ªën</li>
            </ul>
        </div>
        
        <div class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm video karaoke... (VD: 'Em c·ªßa ng√†y h√¥m qua karaoke')" />
                <button id="searchBtn">üîç T√¨m ki·∫øm</button>
            </div>
        </div>
        
        <div class="video-section">
            <div id="youtubePlayer"></div>
        </div>
        
        <div class="controls-section">
            <div class="control-group">
                <h3>üé§ ƒêi·ªÅu khi·ªÉn Micro</h3>
                <button id="micToggle">B·∫≠t Micro</button>
                <div class="mic-status mic-off" id="micStatus">Micro: T·∫ÆT</div>
                
                <div class="control-item">
                    <label>üîä √Çm l∆∞·ª£ng Micro: <span class="value-display" id="micVolumeVal">100%</span></label>
                    <input type="range" id="micVolume" min="0" max="200" value="100" />
                </div>
            </div>
            
            <div class="control-group">
                <h3>üéµ Hi·ªáu ·ª©ng Echo</h3>
                <div class="control-item">
                    <label>‚è±Ô∏è ƒê·ªô tr·ªÖ Echo: <span class="value-display" id="delayTimeVal">0.3s</span></label>
                    <input type="range" id="delayTime" min="0" max="1" step="0.05" value="0.3" />
                </div>
                
                <div class="control-item">
                    <label>üîÅ Ph·∫£n h·ªìi Echo: <span class="value-display" id="feedbackVal">40%</span></label>
                    <input type="range" id="feedback" min="0" max="90" value="40" />
                </div>
                
                <div class="control-item">
                    <label>üíß Mix Echo: <span class="value-display" id="wetVal">30%</span></label>
                    <input type="range" id="wet" min="0" max="100" value="30" />
                </div>
            </div>
            
            <div class="control-group">
                <h3>üéº Hi·ªáu ·ª©ng Reverb</h3>
                <div class="control-item">
                    <label>‚è∞ Th·ªùi gian Reverb: <span class="value-display" id="reverbDecayVal">2.0s</span></label>
                    <input type="range" id="reverbDecay" min="0" max="10" step="0.1" value="2" />
                </div>
                
                <div class="control-item">
                    <label>üíß Mix Reverb: <span class="value-display" id="reverbWetVal">20%</span></label>
                    <input type="range" id="reverbWet" min="0" max="100" value="20" />
                </div>
            </div>
            
            <div class="control-group">
                <h3>üéöÔ∏è B·ªô ch·ªânh √¢m (EQ)</h3>
                <div class="control-item">
                    <label>üîä Bass (Tr·∫ßm): <span class="value-display" id="bassVal">0 dB</span></label>
                    <input type="range" id="bass" min="-12" max="12" value="0" />
                </div>
                
                <div class="control-item">
                    <label>üéµ Mid (Trung): <span class="value-display" id="midVal">0 dB</span></label>
                    <input type="range" id="mid" min="-12" max="12" value="0" />
                </div>
                
                <div class="control-item">
                    <label>‚ú® Treble (Cao): <span class="value-display" id="trebleVal">0 dB</span></label>
                    <input type="range" id="treble" min="-12" max="12" value="0" />
                </div>
            </div>
            
            <div class="control-group">
                <h3>üé∂ √Çm l∆∞·ª£ng Nh·∫°c</h3>
                <div class="control-item">
                    <label>üîä √Çm l∆∞·ª£ng YouTube: <span class="value-display" id="musicVolumeVal">50%</span></label>
                    <input type="range" id="musicVolume" min="0" max="100" value="50" />
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let audioContext;
        let microphone;
        let micGainNode;
        let delayNode;
        let feedbackGainNode;
        let wetGainNode;
        let dryGainNode;
        let convolverNode;
        let reverbGainNode;
        let bassFilter;
        let midFilter;
        let trebleFilter;
        let isMicActive = false;
        let player;
        const API_KEY = 'AIzaSyBCFp0a-57DPEhPNx_k1eBxTc-MrKCfr-8';

        // YouTube Player API
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtubePlayer', {
                height: '450',
                width: '100%',
                videoId: 'dQw4w9WgXcQ',
                playerVars: {
                    'autoplay': 0,
                    'controls': 1,
                    'rel': 0
                },
                events: {
                    'onReady': onPlayerReady
                }
            });
        }

        function onPlayerReady(event) {
            player.setVolume(50);
        }

        // T√¨m ki·∫øm YouTube
        document.getElementById('searchBtn').addEventListener('click', searchYouTube);
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchYouTube();
            }
        });

        function searchYouTube() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=1&q=${encodeURIComponent(query)}&type=video&key=${API_KEY}`)
                .then(response => response.json())
                .then(data => {
                    if (data.items && data.items.length > 0) {
                        const videoId = data.items[0].id.videoId;
                        player.loadVideoById(videoId);
                    } else {
                        alert('Kh√¥ng t√¨m th·∫•y video!');
                    }
                })
                .catch(error => {
                    console.error('L·ªói t√¨m ki·∫øm:', error);
                    alert('L·ªói t√¨m ki·∫øm video. Vui l√≤ng th·ª≠ l·∫°i!');
                });
        }

        // Kh·ªüi t·∫°o Audio Context
        function initAudioContext() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // T·∫°o c√°c node
            micGainNode = audioContext.createGain();
            delayNode = audioContext.createDelay(5.0);
            feedbackGainNode = audioContext.createGain();
            wetGainNode = audioContext.createGain();
            dryGainNode = audioContext.createGain();
            convolverNode = audioContext.createConvolver();
            reverbGainNode = audioContext.createGain();
            
            // EQ Filters
            bassFilter = audioContext.createBiquadFilter();
            bassFilter.type = 'lowshelf';
            bassFilter.frequency.value = 200;
            
            midFilter = audioContext.createBiquadFilter();
            midFilter.type = 'peaking';
            midFilter.frequency.value = 1000;
            midFilter.Q.value = 0.5;
            
            trebleFilter = audioContext.createBiquadFilter();
            trebleFilter.type = 'highshelf';
            trebleFilter.frequency.value = 3000;
            
            // Thi·∫øt l·∫≠p gi√° tr·ªã m·∫∑c ƒë·ªãnh
            micGainNode.gain.value = 1.0;
            delayNode.delayTime.value = 0.3;
            feedbackGainNode.gain.value = 0.4;
            wetGainNode.gain.value = 0.3;
            dryGainNode.gain.value = 1.0;
            reverbGainNode.gain.value = 0.2;
            
            // T·∫°o impulse response cho reverb
            createReverbImpulse(2.0);
        }

        // T·∫°o reverb impulse
        function createReverbImpulse(duration) {
            const sampleRate = audioContext.sampleRate;
            const length = sampleRate * duration;
            const impulse = audioContext.createBuffer(2, length, sampleRate);
            const impulseL = impulse.getChannelData(0);
            const impulseR = impulse.getChannelData(1);
            
            for (let i = 0; i < length; i++) {
                const decay = Math.exp(-i / (sampleRate * duration * 0.5));
                impulseL[i] = (Math.random() * 2 - 1) * decay;
                impulseR[i] = (Math.random() * 2 - 1) * decay;
            }
            
            convolverNode.buffer = impulse;
        }

        // B·∫≠t/T·∫Øt Micro
        document.getElementById('micToggle').addEventListener('click', async function() {
            if (!isMicActive) {
                try {
                    if (!audioContext) {
                        initAudioContext();
                    }
                    
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: false,
                            noiseSuppression: false,
                            autoGainControl: false
                        } 
                    });
                    
                    microphone = audioContext.createMediaStreamSource(stream);
                    
                    // K·∫øt n·ªëi: Micro -> Gain -> EQ -> Effects -> Output
                    microphone.connect(micGainNode);
                    
                    // EQ chain
                    micGainNode.connect(bassFilter);
                    bassFilter.connect(midFilter);
                    midFilter.connect(trebleFilter);
                    
                    // Dry signal
                    trebleFilter.connect(dryGainNode);
                    dryGainNode.connect(audioContext.destination);
                    
                    // Delay/Echo
                    trebleFilter.connect(delayNode);
                    delayNode.connect(feedbackGainNode);
                    feedbackGainNode.connect(delayNode);
                    delayNode.connect(wetGainNode);
                    wetGainNode.connect(audioContext.destination);
                    
                    // Reverb
                    trebleFilter.connect(convolverNode);
                    convolverNode.connect(reverbGainNode);
                    reverbGainNode.connect(audioContext.destination);
                    
                    isMicActive = true;
                    this.textContent = 'T·∫Øt Micro';
                    document.getElementById('micStatus').textContent = 'Micro: B·∫¨T';
                    document.getElementById('micStatus').className = 'mic-status mic-on';
                } catch (error) {
                    console.error('L·ªói truy c·∫≠p micro:', error);
                    alert('Kh√¥ng th·ªÉ truy c·∫≠p micro. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p!');
                }
            } else {
                if (microphone) {
                    microphone.disconnect();
                    microphone = null;
                }
                isMicActive = false;
                this.textContent = 'B·∫≠t Micro';
                document.getElementById('micStatus').textContent = 'Micro: T·∫ÆT';
                document.getElementById('micStatus').className = 'mic-status mic-off';
            }
        });

        // Controls
        document.getElementById('micVolume').addEventListener('input', function() {
            if (micGainNode) {
                micGainNode.gain.value = this.value / 100;
            }
            document.getElementById('micVolumeVal').textContent = this.value + '%';
        });

        document.getElementById('delayTime').addEventListener('input', function() {
            if (delayNode) {
                delayNode.delayTime.value = parseFloat(this.value);
            }
            document.getElementById('delayTimeVal').textContent = this.value + 's';
        });

        document.getElementById('feedback').addEventListener('input', function() {
            if (feedbackGainNode) {
                feedbackGainNode.gain.value = this.value / 100;
            }
            document.getElementById('feedbackVal').textContent = this.value + '%';
        });

        document.getElementById('wet').addEventListener('input', function() {
            if (wetGainNode) {
                wetGainNode.gain.value = this.value / 100;
            }
            document.getElementById('wetVal').textContent = this.value + '%';
        });

        document.getElementById('reverbDecay').addEventListener('input', function() {
            createReverbImpulse(parseFloat(this.value));
            document.getElementById('reverbDecayVal').textContent = this.value + 's';
        });

        document.getElementById('reverbWet').addEventListener('input', function() {
            if (reverbGainNode) {
                reverbGainNode.gain.value = this.value / 100;
            }
            document.getElementById('reverbWetVal').textContent = this.value + '%';
        });

        document.getElementById('bass').addEventListener('input', function() {
            if (bassFilter) {
                bassFilter.gain.value = parseFloat(this.value);
            }
            document.getElementById('bassVal').textContent = this.value + ' dB';
        });

        document.getElementById('mid').addEventListener('input', function() {
            if (midFilter) {
                midFilter.gain.value = parseFloat(this.value);
            }
            document.getElementById('midVal').textContent = this.value + ' dB';
        });

        document.getElementById('treble').addEventListener('input', function() {
            if (trebleFilter) {
                trebleFilter.gain.value = parseFloat(this.value);
            }
            document.getElementById('trebleVal').textContent = this.value + ' dB';
        });

        document.getElementById('musicVolume').addEventListener('input', function() {
            if (player && player.setVolume) {
                player.setVolume(this.value);
            }
            document.getElementById('musicVolumeVal').textContent = this.value + '%';
        });
    </script>
</body>
</html>
