<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Tạo link cài đặt iOS OTA (.plist)</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; background: #f7f7f9; color: #222; padding: 24px; }
    h1 { font-size: 1.3rem; }
    label { display:block; margin:10px 0 2px;}
    input[type="text"] { width: 100%; max-width: 480px; padding: 8px; border-radius: 6px; border:1px solid #bbb; margin-bottom: 10px;}
    button { padding:10px 18px; border-radius:6px; background:#1976d2; color:#fff; border:none; font-size:1rem; cursor:pointer;}
    button:disabled { opacity:0.6; cursor:not-allowed;}
    .result { background: #fff; border-radius: 8px; margin-top: 18px; padding: 16px 20px; border: 1px solid #eee;}
    .result label {margin:0;}
    .note {font-size:0.92rem; color:#555; margin-top:10px;}
    .install-link {display:inline-block; margin-top:8px; font-weight: bold; color:#1976d2;}
    .plist-link {display:inline-block; margin-top:8px;}
    .footer{margin-top:40px;text-align:center;color:#555;font-size:0.95rem;}
  </style>
</head>
<body>
  <h1>Tạo link cài đặt iOS (itms-services)</h1>
  <label>Nhập Link iPA:</label>
  <input type="text" id="ipaUrl" placeholder="https://.../yourapp.ipa">

  <label>Nhập Bundle ID:</label>
  <input type="text" id="bundleId" placeholder="com.example.app">

  <label>Nhập Phiên Bản:</label>
  <input type="text" id="version" placeholder="1.0.0">

  <label>Nhập Tên App:</label>
  <input type="text" id="appName" placeholder="Tên ứng dụng">

  <button id="generateBtn">Tạo file .plist & Link cài đặt</button>

  <div id="result" class="result" style="display:none"></div>
  <div class="note">
    * File .plist được tạo trên trình duyệt, bạn cần upload lên host HTTPS của bạn để link cài đặt dùng cho thiết bị khác.<br>
    * Link cài đặt <b>itms-services://</b> chỉ hoạt động trên thiết bị iOS.
  </div>
  <div class="footer">
    © 2025 - by Minh Nhut
  </div>
<script>
const PLIST_TEMPLATE_URL = "https://raw.githubusercontent.com/nhut990/files/refs/heads/main/hinh/Test_taocaidat.plist";

function escapeXml(str) {
  // Đảm bảo an toàn XML
  return str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");
}

document.getElementById('generateBtn').onclick = async function() {
  const ipaUrl = document.getElementById('ipaUrl').value.trim();
  const bundleId = document.getElementById('bundleId').value.trim();
  const version = document.getElementById('version').value.trim();
  const appName = document.getElementById('appName').value.trim();
  const result = document.getElementById('result');
  result.style.display = "none";
  result.innerHTML = "";

  if(!ipaUrl || !bundleId || !version || !appName) {
    alert("Vui lòng nhập đầy đủ thông tin!");
    return;
  }

  result.innerHTML = "Đang tạo file .plist, vui lòng đợi...";
  result.style.display = "block";

  // Lấy file .plist mẫu
  let template;
  try {
    const resp = await fetch(PLIST_TEMPLATE_URL);
    template = await resp.text();
  } catch(e) {
    result.innerHTML = "Không thể tải file .plist mẫu!";
    return;
  }

  // Thay thế các biến placeholder trong template
  let plist = template
    .replace(/__IPA_URL__/g, escapeXml(ipaUrl))
    .replace(/__BUNDLE_ID__/g, escapeXml(bundleId))
    .replace(/__VERSION__/g, escapeXml(version))
    .replace(/__APP_NAME__/g, escapeXml(appName));

  // Tạo Blob và objectURL cho .plist
  const plistBlob = new Blob([plist], {type:"application/xml"});
  const plistUrl = URL.createObjectURL(plistBlob);

  // itms-services link (blob: chỉ dùng được trên máy bạn, không dùng cho thiết bị khác)
  const itmsLink = `itms-services://?action=download-manifest&url=${encodeURIComponent(plistUrl)}`;

  // Hiển thị kết quả
  result.innerHTML = `
    <label>File .plist đã tạo:</label><br>
    <a class="plist-link" href="${plistUrl}" download="${appName.replace(/\s+/g,"_") || "app"}.plist">Tải file .plist về</a>
    <br>
    <label>Link cài đặt (dùng cho iOS):</label><br>
    <a class="install-link" href="${itmsLink}">${itmsLink}</a>
    <div class="note">* Để cài đặt trên thiết bị khác, hãy upload file .plist này lên host HTTPS công khai và thay link <b>url=...</b> thành link file .plist của bạn.<br>
    VD: <code>itms-services://?action=download-manifest&url=https://domain.com/path/file.plist</code></div>
    <br>
    <details>
      <summary>Xem nội dung file .plist</summary>
      <pre style="max-width:700px;overflow:auto;background:#f6f6f8;border:1px solid #eee;border-radius:8px;padding:10px;font-size:0.97em">${plist.replace(/[<>&]/g, c=>({"<":"&lt;",">":"&gt;","&":"&amp;"}[c]))}</pre>
    </details>
  `;
};
</script>
</body>
</html>