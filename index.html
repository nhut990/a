<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ƒê√†n Piano - Tone Dm</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

```
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 5px;
        touch-action: manipulation;
        overflow-x: hidden;
    }
    
    .container {
        width: 100%;
        max-width: 100vw;
    }
    
    .title {
        text-align: center;
        color: white;
        margin-bottom: 8px;
        font-size: 18px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .chords-section {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 8px;
        margin-bottom: 8px;
    }
    
    .chords-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 5px;
        margin-bottom: 8px;
    }
    
    .chord-btn {
        background: linear-gradient(145deg, #4CAF50, #45a049);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 5px;
        font-size: 13px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 3px 5px rgba(0,0,0,0.3);
        transition: all 0.1s;
        touch-action: manipulation;
    }
    
    .chord-btn:active, .chord-btn.playing {
        transform: scale(0.95);
        box-shadow: 0 2px 3px rgba(0,0,0,0.3);
        background: linear-gradient(145deg, #66BB6A, #5CB860);
    }
    
    .controls {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .loop-btn {
        background: linear-gradient(145deg, #2196F3, #1976D2);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 15px;
        font-size: 13px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 3px 5px rgba(0,0,0,0.3);
        transition: all 0.1s;
        touch-action: manipulation;
    }
    
    .loop-btn.active {
        background: linear-gradient(145deg, #f44336, #d32f2f);
    }
    
    .loop-btn:active {
        transform: scale(0.95);
    }
    
    .speed-control {
        display: flex;
        align-items: center;
        gap: 5px;
        background: rgba(255,255,255,0.2);
        padding: 5px 10px;
        border-radius: 8px;
    }
    
    .speed-control label {
        color: white;
        font-size: 12px;
        white-space: nowrap;
    }
    
    .speed-control input {
        width: 80px;
    }
    
    .speed-value {
        color: white;
        font-size: 12px;
        font-weight: bold;
        min-width: 35px;
    }
    
    .piano-container {
        background: rgba(0,0,0,0.3);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        overflow-x: auto;
        overflow-y: hidden;
    }
    
    .piano {
        position: relative;
        height: 180px;
        width: 840px;
        margin: 0 auto;
    }
    
    .white-key {
        position: absolute;
        width: 60px;
        height: 180px;
        background: linear-gradient(to bottom, #ffffff 0%, #f0f0f0 100%);
        border: 2px solid #222;
        border-radius: 0 0 5px 5px;
        cursor: pointer;
        user-select: none;
        touch-action: manipulation;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 8px;
        font-size: 11px;
        color: #666;
        font-weight: bold;
    }
    
    .white-key:active {
        background: linear-gradient(to bottom, #e8e8e8 0%, #d8d8d8 100%);
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .black-key {
        position: absolute;
        width: 40px;
        height: 115px;
        background: linear-gradient(to bottom, #444 0%, #000 100%);
        border: 1px solid #000;
        border-radius: 0 0 3px 3px;
        cursor: pointer;
        user-select: none;
        touch-action: manipulation;
        z-index: 10;
        color: white;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 6px;
        font-size: 9px;
        font-weight: bold;
        box-shadow: 0 3px 5px rgba(0,0,0,0.5);
    }
    
    .black-key:active {
        background: linear-gradient(to bottom, #666 0%, #333 100%);
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
    }
    
    .info {
        text-align: center;
        color: white;
        margin-top: 8px;
        font-size: 11px;
        line-height: 1.4;
    }

    @media (max-width: 600px) {
        .chords-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <h1 class="title">üéπ ƒê√†n Piano - Tone Dm</h1>

```
    <div class="chords-section">
        <div class="chords-grid">
            <button class="chord-btn" data-chord="Dm">Dm</button>
            <button class="chord-btn" data-chord="Am">Am</button>
            <button class="chord-btn" data-chord="Bb">B‚ô≠</button>
            <button class="chord-btn" data-chord="C">C</button>
            <button class="chord-btn" data-chord="F">F</button>
            <button class="chord-btn" data-chord="Gm">Gm</button>
            <button class="chord-btn" data-chord="A7">A7</button>
            <button class="chord-btn" data-chord="Dm7">Dm7</button>
        </div>
        
        <div class="controls">
            <button class="loop-btn" id="loopBtn">‚ñ∂ L·∫∑p</button>
            <div class="speed-control">
                <label>T·ªëc ƒë·ªô:</label>
                <input type="range" id="speedSlider" min="100" max="500" value="250" step="50">
                <span class="speed-value" id="speedValue">250ms</span>
            </div>
        </div>
    </div>
    
    <div class="piano-container">
        <div class="piano" id="piano"></div>
    </div>
    
    <div class="info">
        B·∫•m h·ª£p √¢m ‚Üí B·∫•m "‚ñ∂ L·∫∑p" ƒë·ªÉ l·∫∑p li√™n t·ª•c ‚Üí ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô
    </div>
</div>

<script>
    // T·ªëi ∆∞u cho iOS - t·∫°o AudioContext sau user interaction
    let audioContext = null;
    let isLooping = false;
    let currentChord = null;
    let loopInterval = null;
    let chordSpeed = 250;
    
    function initAudioContext() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }
    }
    
    // ƒê·ªãnh nghƒ©a c√°c n·ªët nh·∫°c
    const notes = {
        'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
        'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
        'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
        'C5': 523.25, 'C#5': 554.37, 'D5': 587.33, 'D#5': 622.25, 
        'E5': 659.25, 'F5': 698.46, 'F#5': 739.99, 'G5': 783.99,
        'G#5': 830.61, 'A5': 880.00, 'A#5': 932.33, 'B5': 987.77
    };
    
    // ƒê·ªãnh nghƒ©a h·ª£p √¢m
    const chords = {
        'Dm': ['D4', 'F4', 'A4'],
        'Am': ['A4', 'C5', 'E5'],
        'Bb': ['A#4', 'D5', 'F4'],
        'C': ['C4', 'E4', 'G4'],
        'F': ['F4', 'A4', 'C5'],
        'Gm': ['G4', 'A#4', 'D5'],
        'A7': ['A4', 'C#5', 'E5', 'G4'],
        'Dm7': ['D4', 'F4', 'A4', 'C5']
    };
    
    // T·∫°o b√†n ph√≠m piano
    const piano = document.getElementById('piano');
    
    const whiteKeysData = [
        {note: 'C4', left: 0}, {note: 'D4', left: 60}, {note: 'E4', left: 120},
        {note: 'F4', left: 180}, {note: 'G4', left: 240}, {note: 'A4', left: 300},
        {note: 'B4', left: 360}, {note: 'C5', left: 420}, {note: 'D5', left: 480},
        {note: 'E5', left: 540}, {note: 'F5', left: 600}, {note: 'G5', left: 660},
        {note: 'A5', left: 720}, {note: 'B5', left: 780}
    ];
    
    const blackKeysData = [
        {note: 'C#4', left: 40}, {note: 'D#4', left: 100},
        {note: 'F#4', left: 220}, {note: 'G#4', left: 280}, {note: 'A#4', left: 340},
        {note: 'C#5', left: 460}, {note: 'D#5', left: 520},
        {note: 'F#5', left: 640}, {note: 'G#5', left: 700}, {note: 'A#5', left: 760}
    ];
    
    // T·∫°o ph√≠m tr·∫Øng
    whiteKeysData.forEach(data => {
        const key = document.createElement('div');
        key.className = 'white-key';
        key.dataset.note = data.note;
        key.textContent = data.note;
        key.style.left = data.left + 'px';
        
        key.addEventListener('touchstart', (e) => {
            e.preventDefault();
            initAudioContext();
            playNote(data.note);
        });
        key.addEventListener('mousedown', () => {
            initAudioContext();
            playNote(data.note);
        });
        
        piano.appendChild(key);
    });
    
    // T·∫°o ph√≠m ƒëen
    blackKeysData.forEach(data => {
        const key = document.createElement('div');
        key.className = 'black-key';
        key.dataset.note = data.note;
        key.textContent = data.note;
        key.style.left = data.left + 'px';
        
        key.addEventListener('touchstart', (e) => {
            e.preventDefault();
            initAudioContext();
            playNote(data.note);
        });
        key.addEventListener('mousedown', () => {
            initAudioContext();
            playNote(data.note);
        });
        
        piano.appendChild(key);
    });
    
    // H√†m ph√°t √¢m thanh - t·ªëi ∆∞u cho iOS
    function playNote(note, duration = 1.5) {
        if (!audioContext || !notes[note]) return;
        
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = notes[note];
        oscillator.type = 'sine';
        
        const now = audioContext.currentTime;
        gainNode.gain.setValueAtTime(0, now);
        gainNode.gain.linearRampToValueAtTime(0.3, now + 0.01);
        gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
        
        oscillator.start(now);
        oscillator.stop(now + duration);
    }
    
    // H√†m ph√°t h·ª£p √¢m
    function playChord(chordName) {
        const chordNotes = chords[chordName];
        if (!chordNotes) return;
        
        chordNotes.forEach((note, index) => {
            setTimeout(() => {
                playNote(note, 2.0);
            }, index * chordSpeed);
        });
    }
    
    // X·ª≠ l√Ω n√∫t h·ª£p √¢m
    const chordButtons = document.querySelectorAll('.chord-btn');
    chordButtons.forEach(btn => {
        const handler = () => {
            initAudioContext();
            const chord = btn.dataset.chord;
            currentChord = chord;
            playChord(chord);
            
            // Highlight button
            chordButtons.forEach(b => b.classList.remove('playing'));
            btn.classList.add('playing');
            setTimeout(() => btn.classList.remove('playing'), 1000);
        };
        
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handler();
        });
        btn.addEventListener('click', handler);
    });
    
    // X·ª≠ l√Ω n√∫t l·∫∑p
    const loopBtn = document.getElementById('loopBtn');
    loopBtn.addEventListener('click', () => {
        initAudioContext();
        isLooping = !isLooping;
        
        if (isLooping) {
            if (!currentChord) {
                currentChord = 'Dm';
            }
            loopBtn.textContent = '‚è∏ D·ª´ng';
            loopBtn.classList.add('active');
            startLoop();
        } else {
            loopBtn.textContent = '‚ñ∂ L·∫∑p';
            loopBtn.classList.remove('active');
            stopLoop();
        }
    });
    
    function startLoop() {
        if (!currentChord) return;
        
        const chordNotes = chords[currentChord];
        const totalDuration = chordNotes.length * chordSpeed + 500;
        
        playChord(currentChord);
        loopInterval = setInterval(() => {
            if (isLooping) {
                playChord(currentChord);
            }
        }, totalDuration);
    }
    
    function stopLoop() {
        if (loopInterval) {
            clearInterval(loopInterval);
            loopInterval = null;
        }
    }
    
    // X·ª≠ l√Ω thanh ƒëi·ªÅu ch·ªânh t·ªëc ƒë·ªô
    const speedSlider = document.getElementById('speedSlider');
    const speedValue = document.getElementById('speedValue');
    
    speedSlider.addEventListener('input', (e) => {
        chordSpeed = parseInt(e.target.value);
        speedValue.textContent = chordSpeed + 'ms';
        
        // Restart loop n·∫øu ƒëang ch·∫°y
        if (isLooping) {
            stopLoop();
            startLoop();
        }
    });
    
    // Kh·ªüi t·∫°o AudioContext khi t∆∞∆°ng t√°c l·∫ßn ƒë·∫ßu
    ['touchstart', 'click'].forEach(event => {
        document.body.addEventListener(event, initAudioContext, { once: true });
    });
</script>
```

</body>
</html>