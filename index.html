<!DOCTYPE html>

<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê√†n Organ ·∫¢o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    .container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 1200px;
        width: 100%;
    }

    h1 {
        text-align: center;
        color: #333;
        margin-bottom: 10px;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 0.9em;
    }

    .controls {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
    }

    .control-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .control-group label {
        font-size: 0.85em;
        color: #555;
        font-weight: 600;
    }

    select, input[type="range"] {
        padding: 8px 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        background: white;
        cursor: pointer;
        transition: border-color 0.3s;
    }

    select:hover, select:focus {
        border-color: #667eea;
        outline: none;
    }

    input[type="range"] {
        width: 150px;
    }

    .keyboard {
        display: flex;
        gap: 2px;
        justify-content: center;
        margin-bottom: 20px;
        position: relative;
        height: 200px;
    }

    .key {
        position: relative;
        cursor: pointer;
        user-select: none;
        transition: all 0.1s;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 10px;
        font-size: 12px;
        font-weight: bold;
    }

    .white-key {
        width: 60px;
        height: 200px;
        background: linear-gradient(to bottom, #ffffff 0%, #f5f5f5 100%);
        border: 2px solid #333;
        border-radius: 0 0 8px 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 1;
    }

    .white-key:hover {
        background: linear-gradient(to bottom, #f0f0f0 0%, #e5e5e5 100%);
    }

    .white-key:active, .white-key.active {
        background: linear-gradient(to bottom, #e0e0e0 0%, #d0d0d0 100%);
        transform: translateY(2px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .black-key {
        width: 40px;
        height: 130px;
        background: linear-gradient(to bottom, #2c2c2c 0%, #1a1a1a 100%);
        border: 2px solid #000;
        border-radius: 0 0 6px 6px;
        position: absolute;
        z-index: 2;
        color: #fff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }

    .black-key:hover {
        background: linear-gradient(to bottom, #3c3c3c 0%, #2a2a2a 100%);
    }

    .black-key:active, .black-key.active {
        background: linear-gradient(to bottom, #1c1c1c 0%, #0a0a0a 100%);
        transform: translateY(2px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
    }

    .instructions {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
    }

    .instructions h3 {
        color: #333;
        margin-bottom: 10px;
    }

    .instructions p {
        color: #666;
        line-height: 1.6;
        margin-bottom: 8px;
    }

    .key-label {
        font-size: 10px;
        opacity: 0.6;
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
        }
        
        h1 {
            font-size: 1.8em;
        }
        
        .white-key {
            width: 45px;
            height: 160px;
        }
        
        .black-key {
            width: 30px;
            height: 100px;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <h1>üéπ ƒê√†n Organ ·∫¢o</h1>
        <p class="subtitle">Ch∆°i ƒë√†n organ v·ªõi b√†n ph√≠m ho·∫∑c chu·ªôt</p>

```
    <div class="controls">
        <div class="control-group">
            <label>Lo·∫°i √¢m thanh:</label>
            <select id="waveType">
                <option value="sine">Sine (√äm √°i)</option>
                <option value="square">Square (M·∫°nh m·∫Ω)</option>
                <option value="sawtooth">Sawtooth (S·∫Øc n√©t)</option>
                <option value="triangle" selected>Triangle (C√¢n b·∫±ng)</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>√Çm l∆∞·ª£ng: <span id="volumeValue">70%</span></label>
            <input type="range" id="volume" min="0" max="100" value="70">
        </div>
        
        <div class="control-group">
            <label>ƒê·ªô vang (Reverb): <span id="reverbValue">30%</span></label>
            <input type="range" id="reverb" min="0" max="100" value="30">
        </div>
    </div>

    <div class="keyboard" id="keyboard"></div>

    <div class="instructions">
        <h3>üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</h3>
        <p><strong>C√°ch 1:</strong> Nh·∫•n chu·ªôt v√†o c√°c ph√≠m ƒë√†n</p>
        <p><strong>C√°ch 2:</strong> S·ª≠ d·ª•ng b√†n ph√≠m m√°y t√≠nh (c√°c ph√≠m ƒë∆∞·ª£c hi·ªÉn th·ªã tr√™n ƒë√†n)</p>
        <p><strong>Ph√≠m tr·∫Øng:</strong> A S D F G H J K L ; '</p>
        <p><strong>Ph√≠m ƒëen:</strong> W E T Y U O P</p>
        <p>üí° <strong>M·∫πo:</strong> Thay ƒë·ªïi lo·∫°i √¢m thanh v√† ƒë·ªô vang ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng kh√°c nhau!</p>
    </div>
</div>

<script>
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioContext = new AudioContext();
    
    const activeOscillators = {};
    const activeGains = {};

    // ƒê·ªãnh nghƒ©a c√°c n·ªët nh·∫°c v·ªõi t·∫ßn s·ªë
    const notes = [
        { note: 'C4', freq: 261.63, key: 'A', color: 'white' },
        { note: 'C#4', freq: 277.18, key: 'W', color: 'black', offset: 45 },
        { note: 'D4', freq: 293.66, key: 'S', color: 'white' },
        { note: 'D#4', freq: 311.13, key: 'E', color: 'black', offset: 107 },
        { note: 'E4', freq: 329.63, key: 'D', color: 'white' },
        { note: 'F4', freq: 349.23, key: 'F', color: 'white' },
        { note: 'F#4', freq: 369.99, key: 'T', color: 'black', offset: 231 },
        { note: 'G4', freq: 392.00, key: 'G', color: 'white' },
        { note: 'G#4', freq: 415.30, key: 'Y', color: 'black', offset: 293 },
        { note: 'A4', freq: 440.00, key: 'H', color: 'white' },
        { note: 'A#4', freq: 466.16, key: 'U', color: 'black', offset: 355 },
        { note: 'B4', freq: 493.88, key: 'J', color: 'white' },
        { note: 'C5', freq: 523.25, key: 'K', color: 'white' },
        { note: 'C#5', freq: 554.37, key: 'O', color: 'black', offset: 541 },
        { note: 'D5', freq: 587.33, key: 'L', color: 'white' },
        { note: 'D#5', freq: 622.25, key: 'P', color: 'black', offset: 603 },
        { note: 'E5', freq: 659.25, key: ';', color: 'white' },
        { note: 'F5', freq: 698.46, key: "'", color: 'white' }
    ];

    // T·∫°o b√†n ph√≠m
    const keyboard = document.getElementById('keyboard');
    notes.forEach(note => {
        const keyElement = document.createElement('div');
        keyElement.className = note.color === 'white' ? 'key white-key' : 'key black-key';
        keyElement.dataset.note = note.note;
        keyElement.dataset.freq = note.freq;
        keyElement.innerHTML = `${note.note}<br><span class="key-label">${note.key}</span>`;
        
        if (note.color === 'black') {
            keyElement.style.left = `${note.offset}px`;
        }
        
        keyElement.addEventListener('mousedown', () => playNote(note.freq, keyElement));
        keyElement.addEventListener('mouseup', () => stopNote(note.freq, keyElement));
        keyElement.addEventListener('mouseleave', () => stopNote(note.freq, keyElement));
        
        keyboard.appendChild(keyElement);
    });

    // X·ª≠ l√Ω b√†n ph√≠m m√°y t√≠nh
    document.addEventListener('keydown', (e) => {
        if (e.repeat) return;
        const note = notes.find(n => n.key.toLowerCase() === e.key.toLowerCase());
        if (note) {
            const keyElement = document.querySelector(`[data-note="${note.note}"]`);
            playNote(note.freq, keyElement);
        }
    });

    document.addEventListener('keyup', (e) => {
        const note = notes.find(n => n.key.toLowerCase() === e.key.toLowerCase());
        if (note) {
            const keyElement = document.querySelector(`[data-note="${note.note}"]`);
            stopNote(note.freq, keyElement);
        }
    });

    function playNote(frequency, keyElement) {
        if (activeOscillators[frequency]) return;

        // K√≠ch ho·∫°t audio context n·∫øu ch∆∞a ƒë∆∞·ª£c k√≠ch ho·∫°t
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }

        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        const convolver = audioContext.createConvolver();
        const dryGain = audioContext.createGain();
        const wetGain = audioContext.createGain();

        oscillator.type = document.getElementById('waveType').value;
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

        const volume = document.getElementById('volume').value / 100;
        const reverbAmount = document.getElementById('reverb').value / 100;

        // T·∫°o impulse response cho reverb
        const duration = 2;
        const sampleRate = audioContext.sampleRate;
        const length = sampleRate * duration;
        const impulse = audioContext.createBuffer(2, length, sampleRate);
        const impulseL = impulse.getChannelData(0);
        const impulseR = impulse.getChannelData(1);

        for (let i = 0; i < length; i++) {
            impulseL[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 2);
            impulseR[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 2);
        }
        convolver.buffer = impulse;

        dryGain.gain.value = 1 - reverbAmount;
        wetGain.gain.value = reverbAmount;
        gainNode.gain.value = volume;

        // Attack v√† Release m∆∞·ª£t m√†
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.05);

        oscillator.connect(dryGain);
        oscillator.connect(convolver);
        convolver.connect(wetGain);
        dryGain.connect(gainNode);
        wetGain.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.start();

        activeOscillators[frequency] = oscillator;
        activeGains[frequency] = gainNode;

        if (keyElement) {
            keyElement.classList.add('active');
        }
    }

    function stopNote(frequency, keyElement) {
        if (!activeOscillators[frequency]) return;

        const oscillator = activeOscillators[frequency];
        const gainNode = activeGains[frequency];

        // Release m∆∞·ª£t m√†
        gainNode.gain.setValueAtTime(gainNode.gain.value, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

        setTimeout(() => {
            oscillator.stop();
            delete activeOscillators[frequency];
            delete activeGains[frequency];
        }, 100);

        if (keyElement) {
            keyElement.classList.remove('active');
        }
    }

    // C·∫≠p nh·∫≠t hi·ªÉn th·ªã gi√° tr·ªã
    document.getElementById('volume').addEventListener('input', (e) => {
        document.getElementById('volumeValue').textContent = e.target.value + '%';
    });

    document.getElementById('reverb').addEventListener('input', (e) => {
        document.getElementById('reverbValue').textContent = e.target.value + '%';
    });
</script>
```

</body>
</html>